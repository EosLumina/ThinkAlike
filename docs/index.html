<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ThinkAlike Onboarding Guide</title>
    <style>
        body { font-family: sans-serif; }
        #sidebar { min-height: 100vh; overflow-y: auto; width: 250px; background-color: #f8f9fa; border-right: 1px solid #dee2e6; }
        #content { padding-left: 20px; }
        .nav-link { cursor: pointer; padding: .5rem 1rem; color: #007bff; }
        .nav-link:hover { background-color: #e9ecef; }
        .nav-link.active { background-color: #007bff; color: white; }
        .section-content { display: none; margin-bottom: 20px; }
        .active-section { display: block; }
        pre { background-color: #f8f9fa; padding: 10px; border: 1px solid #dee2e6; border-radius: 4px; }
        code { font-family: 'Courier New', Courier, monospace; }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked@4.0.0/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
</head>
<body>

<div class="container-fluid">
    <div class="row">
        <nav id="sidebar" class="col-md-3 col-lg-2">
            <div class="sidebar-sticky px-3 pt-3">
                <ul class="nav flex-column">
                    <li class="nav-item"><a class="nav-link active" href="#" data-section="overview">Project Overview</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-section="core-values">Core Values</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-section="architecture">Architecture</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-section="ui-components">UI Components</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-section="data-handling">Data Handling</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-section="ai-models">AI Models</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-section="testing">Testing</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-section="contributing">Contributing</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-section="quickstart">Quickstart</a></li>
                </ul>
            </div>
        </nav>

        <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4" id="content">
            <div id="overview" class="section-content"></div>
            <div id="core-values" class="section-content"></div>
            <div id="architecture" class="section-content"></div>
            <div id="ui-components" class="section-content"></div>
            <div id="data-handling" class="section-content"></div>
            <div id="ai-models" class="section-content"></div>
            <div id="testing" class="section-content"></div>
            <div id="contributing" class="section-content"></div>
            <div id="quickstart" class="section-content"></div>
        </main>
    </div>
</div>

<script>
    $(document).ready(function() {
        // Configure marked.js
        marked.setOptions({
            gfm: true,
            tables: true,
            breaks: false,
            pedantic: false,
            sanitize: false,
            smartLists: true,
            smartypants: false
        });

        // Configure mermaid.js
        mermaid.initialize({
            startOnLoad: false,
            theme: 'default'
        });

        // Load onboarding_guide.md
        $.get('onboarding_guide.md', function(data) {
            const sections = parseMarkdownSections(data);

            // Render each section
            for (const sectionId in sections) {
                renderSection(sectionId, sections[sectionId]);
            }

            // Show the overview section by default
            $('#overview').addClass('active-section');
            $('.nav-link[data-section="overview"]').addClass('active');

            // Render Mermaid diagrams
            setTimeout(function() {
                mermaid.init(undefined, '.mermaid');
            }, 1000); // Increased delay to ensure DOM is updated
        }).fail(function(jqXHR, textStatus, errorThrown) {
            console.error('Failed to load onboarding_guide.md:', textStatus, errorThrown);
            $('#content').html('<p>Error loading onboarding_guide.md. Please check the file path or server logs.</p>');
        });

        // Load and render quickstart_guide.md
        $.get('quickstart_guide.md', function(data) {
            const htmlContent = marked.parse(data);
            $('#quickstart').html(htmlContent);
            mermaid.init(undefined, '#quickstart .mermaid');
        }).fail(function(jqXHR, textStatus, errorThrown) {
            console.error('Failed to load quickstart_guide.md:', textStatus, errorThrown);
            $('#quickstart').html('<p>Error loading quickstart_guide.md.</p>');
        });

        // Sidebar navigation click handler
        $('.nav-link').click(function(e) {
            e.preventDefault();
            $('.nav-link').removeClass('active');
            $(this).addClass('active');

            const sectionId = $(this).data('section');
            $('.section-content').removeClass('active-section');
            $(`#${sectionId}`).addClass('active-section');
        });

        // Function to parse Markdown into sections
        function parseMarkdownSections(markdown) {
            const sections = {};
            const lines = markdown.split('\n');
            let currentSection = null;

            for (const line of lines) {
                if (line.startsWith('# ')) {
                    currentSection = 'overview';
                } else if (line.startsWith('## ')) {
                    currentSection = sanitizeId(line.substring(3).trim().toLowerCase().replace(/ /g, '-'));
                }
                if (currentSection) {
                    sections[currentSection] = sections[currentSection] || [];
                    sections[currentSection].push(line);
                }
            }
            return sections;
        }

        // Function to render a section
        function renderSection(sectionId, markdownContent) {
            if (!markdownContent) {
                console.warn(`renderSection: markdownContent is falsy for sectionId: ${sectionId}`);
                return;
            }
            const htmlContent = marked.parse(markdownContent.join('\n')); // Use '\n' for line breaks
            $(`#${sectionId}`).html(htmlContent);
        }

        // Function to sanitize section IDs
        function sanitizeId(id) {
            return id.replace(/[:!]/g, ''); // Remove colons and exclamation marks
        }
    });
</script>
</body>
</html>
