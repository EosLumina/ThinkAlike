<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ThinkAlike Onboarding Guide</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body { font-family: sans-serif; }
        #sidebar { min-height: 100vh; overflow-y: auto; width: 250px; } /* Fixed width sidebar */
        #content { padding-left: 20px; }
        .nav-link { cursor: pointer; }
        .section-content { display: none; margin-bottom: 20px;}
        .active-section { display: block; } /* Class for active section */
    </style>
</head>
<body>

<div class="container-fluid">
    <div class="row">
        <nav id="sidebar" class="col-md-3 col-lg-2 bg-light border-right">
            <div class="sidebar-sticky px-3 pt-3">
                <ul class="nav flex-column">
                    <li class="nav-item"><a class="nav-link" href="#" data-section="overview">Project Overview</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-section="core-values">Core Values</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-section="architecture">Architecture</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-section="ui-components">UI Components</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-section="data-handling">Data Handling</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-section="ai-models">AI Models</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-section="testing">Testing</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-section="contributing">Contributing</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-section="quickstart">Quickstart</a></li>
                </ul>
            </div>
        </nav>

        <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4" id="content">
            <div id="overview" class="section-content" style="display: block;"></div>
            <div id="values" class="section-content"></div>
            <div id="architecture" class="section-content"></div>
            <div id="ui-components" class="section-content"></div>
            <div id="data-handling" class="section-content"></div>
            <div id="ai-models" class="section-content"></div>
            <div id="testing" class="section-content"></div>
            <div id="contributing" class="section-content"></div>
            <div id="quickstart" class="section-content"></div>

        </main>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>
    $(document).ready(function() {
        // Configure marked.js
        marked.setOptions({
            renderer: new marked.Renderer(),
            gfm: true, // Enable GitHub Flavored Markdown
            breaks: false,
            pedantic: false,
            sanitize: false, // IMPORTANT: Allow HTML tags in Markdown
            smartLists: true,
            smartypants: false
        });

        // Load ONBOARDING_GUIDE.md
        $.get('ONBOARDING_GUIDE.md', function(data) { // Corrected Path
            const sections = parseMarkdownSections(data);

            // Render each section
            for (const sectionId in sections) {
                renderSection(sectionId, sections[sectionId]);
            }

            // Show the overview section by default
            $('#overview').show();
            $('.nav-link[data-section="overview"]').addClass('active');

            // Initialize Mermaid *after* rendering Markdown (with a delay)
            setTimeout(function() {
                mermaid.init();
            }, 500); // Increased delay
        });

        // Load and render quickstart.md
        $.get('quickstart.md', function(data) { //Corrected Path
            $('#quickstart').html(marked.parse(data));
        });

        // Sidebar navigation click handler
        $('.nav-link').click(function(e) {
            e.preventDefault();
            $('.nav-link').removeClass('active');
            $(this).addClass('active');

            const sectionId = $(this).data('section');
            $('.section-content').hide(); // Hide all sections
            $(`#${sectionId}`).show(); // Show the selected section
        });

        // Function to parse Markdown into sections
        function parseMarkdownSections(markdown) {
            const sections = {};
            const lines = markdown.split('\n');
            let currentSection = null;

            for (const line of lines) {
                if (line.startsWith('# ')) {
                    currentSection = 'overview';
                    sections[currentSection] = sections[currentSection] || [];
                } else if (line.startsWith('## ')) {
                    // Extract section ID from heading
                    currentSection = line.substring(3).trim().toLowerCase().replace(/ /g, '-');
                    sections[currentSection] = sections[currentSection] || [];
                }

                if (currentSection) {
                    sections[currentSection].push(line);
                }
            }

            return sections;
        }

        // Function to render a section
        function renderSection(sectionId, markdownContent) {
          if (!markdownContent) {
            console.warn(`renderSection: markdownContent is falsy for sectionId: ${sectionId}`);
            return;
          }
          const htmlContent = marked.parse(markdownContent.join('')); // Join with empty string
          $(`#${sectionId}`).html(htmlContent);
        }
    });

    </script>
</body>
</html>
